<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Prisma CRUD App</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
          sans-serif;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
        padding: 20px;
      }

      .container {
        max-width: 1200px;
        margin: 0 auto;
        background: rgba(255, 255, 255, 0.95);
        backdrop-filter: blur(10px);
        border-radius: 20px;
        padding: 30px;
        box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
      }

      h1 {
        text-align: center;
        color: #2d3748;
        margin-bottom: 30px;
        font-size: 2.5rem;
        font-weight: 700;
      }

      .tabs {
        display: flex;
        gap: 10px;
        margin-bottom: 30px;
        border-bottom: 2px solid #e2e8f0;
      }

      .tab {
        padding: 12px 24px;
        background: none;
        border: none;
        cursor: pointer;
        font-size: 16px;
        font-weight: 600;
        color: #718096;
        border-radius: 10px 10px 0 0;
        transition: all 0.3s ease;
      }

      .tab.active {
        background: linear-gradient(135deg, #667eea, #764ba2);
        color: white;
        transform: translateY(-2px);
      }

      .tab-content {
        display: none;
      }

      .tab-content.active {
        display: block;
      }

      .form-section {
        background: #f7fafc;
        padding: 25px;
        border-radius: 15px;
        margin-bottom: 30px;
        border: 1px solid #e2e8f0;
      }

      .form-group {
        margin-bottom: 20px;
      }

      label {
        display: block;
        margin-bottom: 8px;
        font-weight: 600;
        color: #2d3748;
      }

      input,
      textarea,
      select {
        width: 100%;
        padding: 12px 16px;
        border: 2px solid #e2e8f0;
        border-radius: 10px;
        font-size: 16px;
        transition: all 0.3s ease;
        background: white;
      }

      input:focus,
      textarea:focus,
      select:focus {
        outline: none;
        border-color: #667eea;
        box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
      }

      button {
        background: linear-gradient(135deg, #667eea, #764ba2);
        color: white;
        border: none;
        padding: 12px 24px;
        border-radius: 10px;
        cursor: pointer;
        font-size: 16px;
        font-weight: 600;
        transition: all 0.3s ease;
        margin-right: 10px;
        margin-bottom: 10px;
      }

      button:hover {
        transform: translateY(-2px);
        box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
      }

      button.danger {
        background: linear-gradient(135deg, #e53e3e, #c53030);
      }

      button.secondary {
        background: linear-gradient(135deg, #718096, #4a5568);
      }

      .items-grid {
        display: grid;
        gap: 20px;
        margin-top: 30px;
      }

      .item-card {
        background: white;
        padding: 25px;
        border-radius: 15px;
        box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
        border: 1px solid #e2e8f0;
        transition: all 0.3s ease;
      }

      .item-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 20px 40px rgba(0, 0, 0, 0.15);
      }

      .item-header {
        display: flex;
        justify-content: between;
        align-items: center;
        margin-bottom: 15px;
      }

      .item-title {
        font-size: 1.5rem;
        font-weight: 700;
        color: #2d3748;
        margin-bottom: 5px;
      }

      .item-meta {
        font-size: 14px;
        color: #718096;
        margin-bottom: 10px;
      }

      .item-content {
        color: #4a5568;
        line-height: 1.6;
        margin-bottom: 20px;
      }

      .item-actions {
        display: flex;
        gap: 10px;
      }

      .status-badge {
        display: inline-block;
        padding: 4px 12px;
        border-radius: 20px;
        font-size: 12px;
        font-weight: 600;
        text-transform: uppercase;
      }

      .published {
        background: #c6f6d5;
        color: #22543d;
      }

      .draft {
        background: #fed7d7;
        color: #742a2a;
      }

      .loading {
        text-align: center;
        padding: 40px;
        color: #718096;
        font-style: italic;
      }

      .error {
        background: #fed7d7;
        color: #742a2a;
        padding: 15px;
        border-radius: 10px;
        margin-bottom: 20px;
        border: 1px solid #feb2b2;
      }

      .success {
        background: #c6f6d5;
        color: #22543d;
        padding: 15px;
        border-radius: 10px;
        margin-bottom: 20px;
        border: 1px solid #9ae6b4;
      }

      @media (max-width: 768px) {
        .container {
          padding: 15px;
        }

        .tabs {
          flex-wrap: wrap;
        }

        .tab {
          flex: 1;
          min-width: 120px;
        }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>Prisma CRUD Application</h1>

      <div class="tabs">
        <button class="tab active" onclick="switchTab('users')">Users</button>
        <button class="tab" onclick="switchTab('posts')">Posts</button>
      </div>

      <!-- Users Tab -->
      <div id="users" class="tab-content active">
        <div class="form-section">
          <h2>Add New User</h2>
          <form id="userForm">
            <input type="hidden" id="userId" />
            <div class="form-group">
              <label for="userName">Name *</label>
              <input type="text" id="userName" required />
            </div>
            <div class="form-group">
              <label for="userEmail">Email *</label>
              <input type="email" id="userEmail" required />
            </div>
            <div class="form-group">
              <label for="userAge">Age</label>
              <input type="number" id="userAge" min="1" max="120" />
            </div>
            <button type="submit">Add User</button>
            <button type="button" onclick="resetUserForm()" class="secondary">
              Reset
            </button>
          </form>
        </div>

        <div id="usersList" class="items-grid">
          <div class="loading">Loading users...</div>
        </div>
      </div>

      <!-- Posts Tab -->
      <div id="posts" class="tab-content">
        <div class="form-section">
          <h2>Add New Post</h2>
          <form id="postForm">
            <input type="hidden" id="postId" />
            <div class="form-group">
              <label for="postTitle">Title *</label>
              <input type="text" id="postTitle" required />
            </div>
            <div class="form-group">
              <label for="postContent">Content</label>
              <textarea id="postContent" rows="4"></textarea>
            </div>
            <div class="form-group">
              <label for="postAuthor">Author *</label>
              <select id="postAuthor" required>
                <option value="">Select an author</option>
              </select>
            </div>
            <div class="form-group">
              <label>
                <input type="checkbox" id="postPublished" /> Published
              </label>
            </div>
            <button type="submit">Add Post</button>
            <button type="button" onclick="resetPostForm()" class="secondary">
              Reset
            </button>
          </form>
        </div>

        <div id="postsList" class="items-grid">
          <div class="loading">Loading posts...</div>
        </div>
      </div>
    </div>

    <script>
      const API_BASE = "/api";
      let currentEditingUser = null;
      let currentEditingPost = null;

      // Tab switching
      function switchTab(tabName) {
        document
          .querySelectorAll(".tab")
          .forEach((tab) => tab.classList.remove("active"));
        document
          .querySelectorAll(".tab-content")
          .forEach((content) => content.classList.remove("active"));

        document
          .querySelector(`[onclick="switchTab('${tabName}')"]`)
          .classList.add("active");
        document.getElementById(tabName).classList.add("active");

        if (tabName === "users") {
          loadUsers();
        } else if (tabName === "posts") {
          loadPosts();
          loadUsersForSelect();
        }
      }

      // API calls
      async function apiCall(endpoint, options = {}) {
        try {
          const response = await fetch(`${API_BASE}${endpoint}`, {
            headers: {
              "Content-Type": "application/json",
            },
            ...options,
          });

          if (!response.ok) {
            const error = await response.json();
            throw new Error(error.error || "Something went wrong");
          }

          return await response.json();
        } catch (error) {
          console.error("API Error:", error);
          throw error;
        }
      }

      // User operations
      async function loadUsers() {
        try {
          document.getElementById("usersList").innerHTML =
            '<div class="loading">Loading users...</div>';
          const users = await apiCall("/users");
          displayUsers(users);
        } catch (error) {
          document.getElementById(
            "usersList"
          ).innerHTML = `<div class="error">Error loading users: ${error.message}</div>`;
        }
      }

      function displayUsers(users) {
        const usersList = document.getElementById("usersList");

        if (users.length === 0) {
          usersList.innerHTML =
            '<div class="loading">No users found. Add some users to get started!</div>';
          return;
        }

        usersList.innerHTML = users
          .map(
            (user) => `
                <div class="item-card">
                    <div class="item-header">
                        <div>
                            <div class="item-title">${user.name}</div>
                            <div class="item-meta">
                                ${user.email} ${
              user.age ? `• Age: ${user.age}` : ""
            }
                            </div>
                            <div class="item-meta">
                                Posts: ${
                                  user.posts.length
                                } • Created: ${new Date(
              user.createdAt
            ).toLocaleDateString()}
                            </div>
                        </div>
                    </div>
                    <div class="item-actions">
                        <button onclick="editUser(${user.id})">Edit</button>
                        <button onclick="deleteUser(${
                          user.id
                        })" class="danger">Delete</button>
                    </div>
                </div>
            `
          )
          .join("");
      }

      async function createOrUpdateUser(userData) {
        const endpoint = currentEditingUser
          ? `/users/${currentEditingUser}`
          : "/users";
        const method = currentEditingUser ? "PUT" : "POST";

        await apiCall(endpoint, {
          method,
          body: JSON.stringify(userData),
        });

        resetUserForm();
        loadUsers();
        showMessage("User saved successfully!", "success");
      }

      async function editUser(id) {
        try {
          const user = await apiCall(`/users/${id}`);

          document.getElementById("userId").value = user.id;
          document.getElementById("userName").value = user.name;
          document.getElementById("userEmail").value = user.email;
          document.getElementById("userAge").value = user.age || "";

          document.querySelector(
            '#userForm button[type="submit"]'
          ).textContent = "Update User";
          currentEditingUser = id;
        } catch (error) {
          showMessage(`Error loading user: ${error.message}`, "error");
        }
      }

      async function deleteUser(id) {
        if (
          !confirm(
            "Are you sure you want to delete this user? All their posts will also be deleted."
          )
        )
          return;

        try {
          await apiCall(`/users/${id}`, { method: "DELETE" });
          loadUsers();
          showMessage("User deleted successfully!", "success");
        } catch (error) {
          showMessage(`Error deleting user: ${error.message}`, "error");
        }
      }

      function resetUserForm() {
        document.getElementById("userForm").reset();
        document.getElementById("userId").value = "";
        document.querySelector('#userForm button[type="submit"]').textContent =
          "Add User";
        currentEditingUser = null;
      }

      // Post operations
      async function loadPosts() {
        try {
          document.getElementById("postsList").innerHTML =
            '<div class="loading">Loading posts...</div>';
          const posts = await apiCall("/posts");
          displayPosts(posts);
        } catch (error) {
          document.getElementById(
            "postsList"
          ).innerHTML = `<div class="error">Error loading posts: ${error.message}</div>`;
        }
      }

      function displayPosts(posts) {
        const postsList = document.getElementById("postsList");

        if (posts.length === 0) {
          postsList.innerHTML =
            '<div class="loading">No posts found. Add some posts to get started!</div>';
          return;
        }

        postsList.innerHTML = posts
          .map(
            (post) => `
                <div class="item-card">
                    <div class="item-header">
                        <div>
                            <div class="item-title">${post.title}</div>
                            <div class="item-meta">
                                By ${post.author.name} • ${new Date(
              post.createdAt
            ).toLocaleDateString()}
                                <span class="status-badge ${
                                  post.published ? "published" : "draft"
                                }">
                                    ${post.published ? "Published" : "Draft"}
                                </span>
                            </div>
                        </div>
                    </div>
                    ${
                      post.content
                        ? `<div class="item-content">${post.content}</div>`
                        : ""
                    }
                    <div class="item-actions">
                        <button onclick="editPost(${post.id})">Edit</button>
                        <button onclick="deletePost(${
                          post.id
                        })" class="danger">Delete</button>
                    </div>
                </div>
            `
          )
          .join("");
      }

      async function loadUsersForSelect() {
        try {
          const users = await apiCall("/users");
          const select = document.getElementById("postAuthor");
          select.innerHTML =
            '<option value="">Select an author</option>' +
            users
              .map((user) => `<option value="${user.id}">${user.name}</option>`)
              .join("");
        } catch (error) {
          console.error("Error loading users for select:", error);
        }
      }

      async function createOrUpdatePost(postData) {
        const endpoint = currentEditingPost
          ? `/posts/${currentEditingPost}`
          : "/posts";
        const method = currentEditingPost ? "PUT" : "POST";

        await apiCall(endpoint, {
          method,
          body: JSON.stringify(postData),
        });

        resetPostForm();
        loadPosts();
        showMessage("Post saved successfully!", "success");
      }

      async function editPost(id) {
        try {
          const post = await apiCall(`/posts/${id}`);

          document.getElementById("postId").value = post.id;
          document.getElementById("postTitle").value = post.title;
          document.getElementById("postContent").value = post.content || "";
          document.getElementById("postAuthor").value = post.authorId;
          document.getElementById("postPublished").checked = post.published;

          document.querySelector(
            '#postForm button[type="submit"]'
          ).textContent = "Update Post";
          currentEditingPost = id;
        } catch (error) {
          showMessage(`Error loading post: ${error.message}`, "error");
        }
      }

      async function deletePost(id) {
        if (!confirm("Are you sure you want to delete this post?")) return;

        try {
          await apiCall(`/posts/${id}`, { method: "DELETE" });
          loadPosts();
          showMessage("Post deleted successfully!", "success");
        } catch (error) {
          showMessage(`Error deleting post: ${error.message}`, "error");
        }
      }

      function resetPostForm() {
        document.getElementById("postForm").reset();
        document.getElementById("postId").value = "";
        document.querySelector('#postForm button[type="submit"]').textContent =
          "Add Post";
        currentEditingPost = null;
      }

      // Form submission handlers
      document
        .getElementById("userForm")
        .addEventListener("submit", async (e) => {
          e.preventDefault();

          const userData = {
            name: document.getElementById("userName").value.trim(),
            email: document.getElementById("userEmail").value.trim(),
            age: document.getElementById("userAge").value
              ? parseInt(document.getElementById("userAge").value)
              : null,
          };

          try {
            await createOrUpdateUser(userData);
          } catch (error) {
            showMessage(`Error saving user: ${error.message}`, "error");
          }
        });

      document
        .getElementById("postForm")
        .addEventListener("submit", async (e) => {
          e.preventDefault();

          const postData = {
            title: document.getElementById("postTitle").value.trim(),
            content:
              document.getElementById("postContent").value.trim() || null,
            authorId: parseInt(document.getElementById("postAuthor").value),
            published: document.getElementById("postPublished").checked,
          };

          try {
            await createOrUpdatePost(postData);
          } catch (error) {
            showMessage(`Error saving post: ${error.message}`, "error");
          }
        });

      // Utility functions
      function showMessage(message, type = "success") {
        const messageDiv = document.createElement("div");
        messageDiv.className = type;
        messageDiv.textContent = message;

        const container = document.querySelector(".container");
        container.insertBefore(messageDiv, container.children[1]);

        setTimeout(() => {
          messageDiv.remove();
        }, 5000);
      }

      // Initialize the app
      document.addEventListener("DOMContentLoaded", () => {
        loadUsers();
      });
    </script>
  </body>
</html>
